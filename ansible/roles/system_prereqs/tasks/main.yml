---
# Main task file for system prerequisites

- name: Detect if running on WSL
  ansible.builtin.command: grep -qi microsoft /proc/version
  register: wsl_check
  failed_when: false
  changed_when: false

- name: Set WSL fact
  ansible.builtin.set_fact:
    is_wsl: "{{ wsl_check.rc == 0 }}"

- name: Normalize distribution name for prerequisites
  ansible.builtin.set_fact:
    system_prereqs_distro: >-
      {{ 'archlinux' if ansible_facts['distribution'] | lower == 'endeavouros'
         else ansible_facts['distribution'] | lower }}

- name: Include distro-specific prerequisites
  ansible.builtin.include_tasks: "{{ system_prereqs_distro }}.yml"
  when: system_prereqs_distro in ['ubuntu', 'fedora', 'archlinux']

- name: Display system information
  ansible.builtin.debug:
    msg: "Detected {{ ansible_facts['distribution'] }} {{ ansible_facts['distribution_version'] }}, WSL: {{ is_wsl }}"
