---
# Install packages via UV (batch loop)

- name: Install packages via UV
  ansible.builtin.command: "{{ uv_bin }} {{ item.command }}"
  environment:
    PATH: "{{ ansible_path }}"
  loop: "{{ uv_packages }}"
  loop_control:
    label: "{{ item.name }}"
  register: uv_result
  failed_when:
    - uv_result.rc != 0
    - "'Executable already exists' not in uv_result.stderr"
  changed_when:
    - "'is already installed' not in uv_result.stderr"
    - "uv_result.stderr is not regex('Installed \\d+ executable')"
    - "'Executable already exists' not in uv_result.stderr"
