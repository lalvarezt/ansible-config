---
# Install packages via UV (batch loop)

- name: Install packages via UV
  command: "{{ uv_bin }} {{ item.command }}"
  environment:
    PATH: "{{ ansible_path }}"
  loop: "{{ uv_packages }}"
  loop_control:
    label: "{{ item.name }}"
  register: uv_results
  failed_when:
    - uv_results.rc != 0
    - "'Executable already exists' not in uv_results.stderr"
  changed_when:
    - "'is already installed' not in uv_results.stderr"
    - "uv_results.stderr is not regex('Installed \\d+ executable')"
    - "'Executable already exists' not in uv_results.stderr"
