---
# Install packages via paru (bulk)

- name: Filter paru packages (exclude skipped)
  set_fact:
    paru_packages_filtered: "{{ paru_packages | selectattr('skip_on', 'undefined') | map(attribute='name') | list + paru_packages | rejectattr('skip_on', 'undefined') | rejectattr('skip_on', 'contains', 'paru') | map(attribute='name') | list }}"

- name: Install packages via paru
  command: "paru -S --noconfirm --needed {{ paru_packages_filtered | join(' ') }}"
  when: paru_packages_filtered | length > 0
