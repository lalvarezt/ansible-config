---
# System setup: prerequisites, 1Password, SSH, Homebrew, language managers

- name: Setup Workstation Prerequisites
  hosts: all
  gather_facts: true
  tags: [setup]
  module_defaults:
    ansible.builtin.rpm_key:
      validate_certs: "{{ not (skip_ssl_verify | default(false)) }}"
    ansible.builtin.get_url:
      validate_certs: "{{ not (skip_ssl_verify | default(false)) }}"
    ansible.builtin.uri:
      validate_certs: "{{ not (skip_ssl_verify | default(false)) }}"
  roles:
    - role: system_prereqs
    - role: onepassword
    - role: ssh_keys
    - role: homebrew
    - role: lang_managers
  tasks:
    - name: Ensure custom Homebrew taps are present
      community.general.homebrew_tap:
        name: "{{ item }}"
        state: present
      loop: "{{ homebrew_taps }}"
      environment:
        PATH: "{{ ansible_path }}"
